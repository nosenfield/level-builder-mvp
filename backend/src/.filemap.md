# backend/src File Map

Directory containing the Rust backend for the Roblox Level Builder. Converts Space JSON to `.rbxlx` files via HTTP API.

## Files

### lib.rs
Library crate root. Re-exports `models`, `rbxlx`, and `validation` modules for use by binaries and integration tests.

### main.rs
HTTP server entry point using Axum. Exposes `POST /api/export` endpoint that accepts Space JSON, validates it, generates `.rbxlx` content, and returns it as a downloadable file. Configures CORS for cross-origin requests.

**Key exports:** None (binary crate)

**Dependencies:** `models::SpaceJSON`, `rbxlx::generate_rbxlx`, `validation::validate_space_json`

### models.rs
Data structures for Space JSON deserialization.

**Key exports:**
- `SpaceJSON` - Root payload containing `schema_version`, optional `name`, and `blocks` array
- `Block` - Single voxel with `x`, `y`, `z` coordinates (in Roblox studs) and hex `color`

### validation.rs
Input validation for Space JSON payloads. Enforces schema version, block count limits, coordinate bounds, color format, and duplicate detection.

**Key exports:**
- `ValidationError` - Enum with error variants and methods for error codes/messages
- `validate_space_json()` - Full payload validation (fail-fast)
- `validate_schema_version()`, `validate_block_count()`, `validate_coordinate_bounds()`, `validate_color_format()`, `validate_no_duplicates()` - Individual validators
- `MAX_BLOCKS` - Constant (10,000)

**Constraints:**
- Schema version must be 1
- Max 10,000 blocks
- Coordinates: X/Z -1000 to 1000, Y 0 to 1000
- Color format: `#RRGGBB` or `#RGB`

### rbxlx.rs
Generates valid `.rbxlx` (Roblox place) XML files using `rbx-dom-weak` and `rbx-xml`.

**Key exports:**
- `generate_rbxlx()` - Main generation function, creates complete Roblox DataModel
- `hex_to_color3()` - Converts hex string to Roblox Color3
- `calculate_spawn_position()` - Dynamic spawn calculation (currently unused, preserved for future use)

**Generated structure:**
- Workspace with Terrain, Baseplate (200x16x200), user blocks (2x2x2 Parts), SpawnLocation (12x1x12 with Decal)
- Services: Players, Lighting (ShadowMap), ReplicatedStorage, StarterGui, StarterPack, StarterPlayer

## Related Files

- `../tests/validation_tests.rs` - Validation unit tests
- `../tests/rbxlx_tests.rs` - RBXLX generation and integration tests
- `../Cargo.toml` - Crate dependencies and configuration
